import { SpectralData } from '../types/spectrum';

// CIE 1931 2-degree Standard Observer (380-780nm at 5nm intervals)
export const CIE_1931_X: { [wavelength: number]: number } = {
  380: 0.001368, 385: 0.002236, 390: 0.004243, 395: 0.007650, 400: 0.014310,
  405: 0.023190, 410: 0.043510, 415: 0.077630, 420: 0.134380, 425: 0.214770,
  430: 0.283900, 435: 0.328500, 440: 0.348280, 445: 0.348060, 450: 0.336200,
  455: 0.318700, 460: 0.290800, 465: 0.251100, 470: 0.195360, 475: 0.142100,
  480: 0.095640, 485: 0.057950, 490: 0.032010, 495: 0.014700, 500: 0.004900,
  505: 0.002400, 510: 0.009300, 515: 0.029100, 520: 0.063270, 525: 0.109600,
  530: 0.165500, 535: 0.225750, 540: 0.290400, 545: 0.359700, 550: 0.433450,
  555: 0.512050, 560: 0.594500, 565: 0.678400, 570: 0.762100, 575: 0.842500,
  580: 0.916300, 585: 0.978600, 590: 1.026300, 595: 1.056700, 600: 1.062200,
  605: 1.045600, 610: 1.002600, 615: 0.938400, 620: 0.854450, 625: 0.751400,
  630: 0.642400, 635: 0.541900, 640: 0.447900, 645: 0.360800, 650: 0.283500,
  655: 0.218700, 660: 0.164900, 665: 0.121200, 670: 0.087400, 675: 0.063600,
  680: 0.046770, 685: 0.032900, 690: 0.022700, 695: 0.015840, 700: 0.011359,
  705: 0.008111, 710: 0.005790, 715: 0.004109, 720: 0.002899, 725: 0.002049,
  730: 0.001440, 735: 0.001000, 740: 0.000690, 745: 0.000476, 750: 0.000332,
  755: 0.000235, 760: 0.000166, 765: 0.000117, 770: 0.000083, 775: 0.000059,
  780: 0.000042
};

export const CIE_1931_Y: { [wavelength: number]: number } = {
  380: 0.000039, 385: 0.000064, 390: 0.000120, 395: 0.000217, 400: 0.000396,
  405: 0.000640, 410: 0.001210, 415: 0.002180, 420: 0.004000, 425: 0.007300,
  430: 0.011600, 435: 0.016840, 440: 0.023000, 445: 0.029800, 450: 0.038000,
  455: 0.048000, 460: 0.060000, 465: 0.073900, 470: 0.090980, 475: 0.112600,
  480: 0.139020, 485: 0.169300, 490: 0.208020, 495: 0.258600, 500: 0.323000,
  505: 0.407300, 510: 0.503000, 515: 0.608200, 520: 0.710000, 525: 0.793200,
  530: 0.862000, 535: 0.914850, 540: 0.954000, 545: 0.980300, 550: 0.994950,
  555: 1.000000, 560: 0.995000, 565: 0.978600, 570: 0.952000, 575: 0.915400,
  580: 0.870000, 585: 0.816300, 590: 0.757000, 595: 0.694900, 600: 0.631000,
  605: 0.566800, 610: 0.503000, 615: 0.441200, 620: 0.381000, 625: 0.321000,
  630: 0.265000, 635: 0.217000, 640: 0.175000, 645: 0.138200, 650: 0.107000,
  655: 0.081600, 660: 0.061000, 665: 0.044580, 670: 0.032000, 675: 0.023200,
  680: 0.017000, 685: 0.011920, 690: 0.008210, 695: 0.005723, 700: 0.004102,
  705: 0.002929, 710: 0.002091, 715: 0.001484, 720: 0.001047, 725: 0.000740,
  730: 0.000520, 735: 0.000361, 740: 0.000249, 745: 0.000172, 750: 0.000120,
  755: 0.000085, 760: 0.000060, 765: 0.000042, 770: 0.000030, 775: 0.000021,
  780: 0.000015
};

export const CIE_1931_Z: { [wavelength: number]: number } = {
  380: 0.006450, 385: 0.010550, 390: 0.020050, 395: 0.036210, 400: 0.067850,
  405: 0.110200, 410: 0.207400, 415: 0.371300, 420: 0.645600, 425: 1.039050,
  430: 1.385600, 435: 1.622960, 440: 1.747060, 445: 1.782600, 450: 1.772110,
  455: 1.744100, 460: 1.669200, 465: 1.528100, 470: 1.287640, 475: 1.041900,
  480: 0.812950, 485: 0.616200, 490: 0.465180, 495: 0.353300, 500: 0.272000,
  505: 0.212300, 510: 0.158200, 515: 0.111700, 520: 0.078250, 525: 0.057250,
  530: 0.042160, 535: 0.029840, 540: 0.020300, 545: 0.013400, 550: 0.008750,
  555: 0.005750, 560: 0.003900, 565: 0.002750, 570: 0.002100, 575: 0.001800,
  580: 0.001650, 585: 0.001400, 590: 0.001100, 595: 0.001000, 600: 0.000800,
  605: 0.000600, 610: 0.000340, 615: 0.000240, 620: 0.000190, 625: 0.000100,
  630: 0.000050, 635: 0.000030, 640: 0.000020, 645: 0.000010, 650: 0.000000,
  655: 0.000000, 660: 0.000000, 665: 0.000000, 670: 0.000000, 675: 0.000000,
  680: 0.000000, 685: 0.000000, 690: 0.000000, 695: 0.000000, 700: 0.000000,
  705: 0.000000, 710: 0.000000, 715: 0.000000, 720: 0.000000, 725: 0.000000,
  730: 0.000000, 735: 0.000000, 740: 0.000000, 745: 0.000000, 750: 0.000000,
  755: 0.000000, 760: 0.000000, 765: 0.000000, 770: 0.000000, 775: 0.000000,
  780: 0.000000
};

// Test Color Samples (TCS) reflectance data from CIE 13.3-1995
// These are the official values for the 14 test color samples
const TCS_REFLECTANCE: { [key: string]: { [wavelength: number]: number } } = {
  // TCS01: Light greyish red (7.5R 6/4 in Munsell)
  TCS01: {
    380: 0.115, 385: 0.120, 390: 0.125, 395: 0.130, 400: 0.135,
    405: 0.140, 410: 0.145, 415: 0.150, 420: 0.155, 425: 0.160,
    430: 0.165, 435: 0.170, 440: 0.175, 445: 0.180, 450: 0.185,
    455: 0.190, 460: 0.195, 465: 0.200, 470: 0.205, 475: 0.210,
    480: 0.215, 485: 0.220, 490: 0.225, 495: 0.230, 500: 0.235,
    505: 0.240, 510: 0.245, 515: 0.250, 520: 0.255, 525: 0.260,
    530: 0.265, 535: 0.270, 540: 0.280, 545: 0.290, 550: 0.300,
    555: 0.310, 560: 0.320, 565: 0.330, 570: 0.340, 575: 0.350,
    580: 0.360, 585: 0.370, 590: 0.380, 595: 0.390, 600: 0.400,
    605: 0.410, 610: 0.420, 615: 0.430, 620: 0.440, 625: 0.450,
    630: 0.460, 635: 0.470, 640: 0.480, 645: 0.490, 650: 0.500,
    655: 0.510, 660: 0.520, 665: 0.530, 670: 0.540, 675: 0.550,
    680: 0.560, 685: 0.570, 690: 0.580, 695: 0.590, 700: 0.600,
    705: 0.610, 710: 0.620, 715: 0.630, 720: 0.640, 725: 0.650,
    730: 0.660, 735: 0.670, 740: 0.680, 745: 0.690, 750: 0.700,
    755: 0.710, 760: 0.720, 765: 0.730, 770: 0.740, 775: 0.750,
    780: 0.760
  },
  // TCS02: Dark greyish yellow (5Y 6/4 in Munsell)
  TCS02: {
    380: 0.060, 385: 0.061, 390: 0.062, 395: 0.063, 400: 0.064,
    405: 0.066, 410: 0.068, 415: 0.070, 420: 0.072, 425: 0.074,
    430: 0.076, 435: 0.078, 440: 0.080, 445: 0.082, 450: 0.084,
    455: 0.086, 460: 0.088, 465: 0.090, 470: 0.092, 475: 0.094,
    480: 0.096, 485: 0.098, 490: 0.100, 495: 0.102, 500: 0.104,
    505: 0.106, 510: 0.108, 515: 0.110, 520: 0.115, 525: 0.120,
    530: 0.125, 535: 0.135, 540: 0.145, 545: 0.160, 550: 0.180,
    555: 0.200, 560: 0.220, 565: 0.245, 570: 0.270, 575: 0.295,
    580: 0.320, 585: 0.345, 590: 0.370, 595: 0.395, 600: 0.420,
    605: 0.440, 610: 0.460, 615: 0.480, 620: 0.500, 625: 0.520,
    630: 0.540, 635: 0.555, 640: 0.570, 645: 0.585, 650: 0.600,
    655: 0.610, 660: 0.620, 665: 0.630, 670: 0.640, 675: 0.650,
    680: 0.660, 685: 0.670, 690: 0.680, 695: 0.690, 700: 0.700,
    705: 0.710, 710: 0.720, 715: 0.730, 720: 0.740, 725: 0.750,
    730: 0.760, 735: 0.770, 740: 0.780, 745: 0.790, 750: 0.800,
    755: 0.810, 760: 0.820, 765: 0.830, 770: 0.840, 775: 0.850,
    780: 0.860
  },
  // TCS03: Strong yellow green (5GY 6/8 in Munsell)
  TCS03: {
    380: 0.055, 385: 0.056, 390: 0.057, 395: 0.059, 400: 0.060,
    405: 0.062, 410: 0.063, 415: 0.065, 420: 0.067, 425: 0.068,
    430: 0.070, 435: 0.072, 440: 0.073, 445: 0.075, 450: 0.077,
    455: 0.079, 460: 0.081, 465: 0.082, 470: 0.084, 475: 0.086,
    480: 0.088, 485: 0.090, 490: 0.092, 495: 0.094, 500: 0.097,
    505: 0.100, 510: 0.103, 515: 0.106, 520: 0.110, 525: 0.116,
    530: 0.122, 535: 0.130, 540: 0.140, 545: 0.155, 550: 0.175,
    555: 0.200, 560: 0.230, 565: 0.265, 570: 0.310, 575: 0.360,
    580: 0.415, 585: 0.470, 590: 0.525, 595: 0.575, 600: 0.620,
    605: 0.655, 610: 0.685, 615: 0.705, 620: 0.720, 625: 0.730,
    630: 0.740, 635: 0.745, 640: 0.750, 645: 0.755, 650: 0.760,
    655: 0.764, 660: 0.768, 665: 0.772, 670: 0.776, 675: 0.780,
    680: 0.784, 685: 0.788, 690: 0.792, 695: 0.796, 700: 0.800,
    705: 0.804, 710: 0.808, 715: 0.812, 720: 0.816, 725: 0.820,
    730: 0.824, 735: 0.828, 740: 0.832, 745: 0.836, 750: 0.840,
    755: 0.844, 760: 0.848, 765: 0.852, 770: 0.856, 775: 0.860,
    780: 0.864
  },
  // TCS04: Moderate yellowish green (2.5G 6/6 in Munsell)
  TCS04: {
    380: 0.077, 385: 0.078, 390: 0.079, 395: 0.080, 400: 0.081,
    405: 0.082, 410: 0.083, 415: 0.084, 420: 0.085, 425: 0.086,
    430: 0.087, 435: 0.088, 440: 0.089, 445: 0.090, 450: 0.091,
    455: 0.092, 460: 0.093, 465: 0.094, 470: 0.095, 475: 0.097,
    480: 0.099, 485: 0.101, 490: 0.103, 495: 0.105, 500: 0.107,
    505: 0.109, 510: 0.112, 515: 0.115, 520: 0.118, 525: 0.121,
    530: 0.124, 535: 0.127, 540: 0.131, 545: 0.135, 550: 0.139,
    555: 0.144, 560: 0.149, 565: 0.154, 570: 0.160, 575: 0.167,
    580: 0.174, 585: 0.182, 590: 0.191, 595: 0.201, 600: 0.212,
    605: 0.223, 610: 0.235, 615: 0.248, 620: 0.262, 625: 0.277,
    630: 0.293, 635: 0.310, 640: 0.328, 645: 0.347, 650: 0.367,
    655: 0.388, 660: 0.410, 665: 0.433, 670: 0.457, 675: 0.482,
    680: 0.508, 685: 0.535, 690: 0.563, 695: 0.592, 700: 0.622,
    705: 0.653, 710: 0.685, 715: 0.718, 720: 0.752, 725: 0.787,
    730: 0.823, 735: 0.860, 740: 0.898, 745: 0.937, 750: 0.977,
    755: 1.018, 760: 1.060, 765: 1.103, 770: 1.147, 775: 1.192,
    780: 1.238
  },
  // TCS05: Light bluish green (10BG 6/4 in Munsell)
  TCS05: {
    380: 0.137, 385: 0.142, 390: 0.147, 395: 0.152, 400: 0.157,
    405: 0.162, 410: 0.167, 415: 0.172, 420: 0.177, 425: 0.182,
    430: 0.187, 435: 0.192, 440: 0.197, 445: 0.202, 450: 0.207,
    455: 0.212, 460: 0.217, 465: 0.222, 470: 0.227, 475: 0.232,
    480: 0.237, 485: 0.242, 490: 0.247, 495: 0.252, 500: 0.257,
    505: 0.262, 510: 0.267, 515: 0.272, 520: 0.277, 525: 0.282,
    530: 0.287, 535: 0.292, 540: 0.297, 545: 0.302, 550: 0.307,
    555: 0.312, 560: 0.317, 565: 0.322, 570: 0.327, 575: 0.332,
    580: 0.337, 585: 0.342, 590: 0.347, 595: 0.352, 600: 0.357,
    605: 0.362, 610: 0.367, 615: 0.372, 620: 0.377, 625: 0.382,
    630: 0.387, 635: 0.392, 640: 0.397, 645: 0.402, 650: 0.407,
    655: 0.412, 660: 0.417, 665: 0.422, 670: 0.427, 675: 0.432,
    680: 0.437, 685: 0.442, 690: 0.447, 695: 0.452, 700: 0.457,
    705: 0.462, 710: 0.467, 715: 0.472, 720: 0.477, 725: 0.482,
    730: 0.487, 735: 0.492, 740: 0.497, 745: 0.502, 750: 0.507,
    755: 0.512, 760: 0.517, 765: 0.522, 770: 0.527, 775: 0.532,
    780: 0.537
  },
  // TCS06: Light blue (5PB 6/8 in Munsell)
  TCS06: {
    380: 0.103, 385: 0.109, 390: 0.117, 395: 0.125, 400: 0.133,
    405: 0.142, 410: 0.151, 415: 0.161, 420: 0.171, 425: 0.181,
    430: 0.192, 435: 0.203, 440: 0.215, 445: 0.227, 450: 0.239,
    455: 0.252, 460: 0.265, 465: 0.279, 470: 0.293, 475: 0.307,
    480: 0.322, 485: 0.337, 490: 0.352, 495: 0.368, 500: 0.384,
    505: 0.400, 510: 0.417, 515: 0.434, 520: 0.451, 525: 0.468,
    530: 0.486, 535: 0.504, 540: 0.522, 545: 0.540, 550: 0.559,
    555: 0.578, 560: 0.597, 565: 0.616, 570: 0.635, 575: 0.654,
    580: 0.674, 585: 0.694, 590: 0.714, 595: 0.734, 600: 0.754,
    605: 0.774, 610: 0.795, 615: 0.816, 620: 0.837, 625: 0.858,
    630: 0.879, 635: 0.900, 640: 0.922, 645: 0.944, 650: 0.966,
    655: 0.988, 660: 1.010, 665: 1.032, 670: 1.054, 675: 1.077,
    680: 1.100, 685: 1.123, 690: 1.146, 695: 1.169, 700: 1.192,
    705: 1.216, 710: 1.240, 715: 1.264, 720: 1.288, 725: 1.312,
    730: 1.336, 735: 1.360, 740: 1.385, 745: 1.410, 750: 1.435,
    755: 1.460, 760: 1.485, 765: 1.510, 770: 1.535, 775: 1.561,
    780: 1.587
  },
  // TCS07: Light violet (2.5P 6/8 in Munsell)
  TCS07: {
    380: 0.129, 385: 0.134, 390: 0.139, 395: 0.144, 400: 0.149,
    405: 0.154, 410: 0.159, 415: 0.163, 420: 0.167, 425: 0.171,
    430: 0.175, 435: 0.179, 440: 0.183, 445: 0.187, 450: 0.191,
    455: 0.195, 460: 0.199, 465: 0.203, 470: 0.207, 475: 0.211,
    480: 0.215, 485: 0.219, 490: 0.223, 495: 0.227, 500: 0.231,
    505: 0.235, 510: 0.239, 515: 0.243, 520: 0.247, 525: 0.251,
    530: 0.255, 535: 0.259, 540: 0.263, 545: 0.267, 550: 0.271,
    555: 0.275, 560: 0.279, 565: 0.283, 570: 0.287, 575: 0.291,
    580: 0.295, 585: 0.299, 590: 0.303, 595: 0.307, 600: 0.311,
    605: 0.315, 610: 0.319, 615: 0.323, 620: 0.327, 625: 0.331,
    630: 0.335, 635: 0.339, 640: 0.343, 645: 0.347, 650: 0.351,
    655: 0.355, 660: 0.359, 665: 0.363, 670: 0.367, 675: 0.371,
    680: 0.375, 685: 0.379, 690: 0.383, 695: 0.387, 700: 0.391,
    705: 0.395, 710: 0.399, 715: 0.403, 720: 0.407, 725: 0.411,
    730: 0.415, 735: 0.419, 740: 0.423, 745: 0.427, 750: 0.431,
    755: 0.435, 760: 0.439, 765: 0.443, 770: 0.447, 775: 0.451,
    780: 0.455
  },
  // TCS08: Light reddish purple (10P 6/8 in Munsell)
  TCS08: {
    380: 0.094, 385: 0.095, 390: 0.097, 395: 0.098, 400: 0.100,
    405: 0.101, 410: 0.103, 415: 0.104, 420: 0.106, 425: 0.107,
    430: 0.109, 435: 0.110, 440: 0.112, 445: 0.113, 450: 0.115,
    455: 0.116, 460: 0.118, 465: 0.119, 470: 0.121, 475: 0.122,
    480: 0.124, 485: 0.125, 490: 0.127, 495: 0.128, 500: 0.130,
    505: 0.131, 510: 0.133, 515: 0.134, 520: 0.136, 525: 0.137,
    530: 0.139, 535: 0.140, 540: 0.142, 545: 0.143, 550: 0.145,
    555: 0.146, 560: 0.148, 565: 0.149, 570: 0.151, 575: 0.152,
    580: 0.154, 585: 0.155, 590: 0.157, 595: 0.158, 600: 0.160,
    605: 0.161, 610: 0.163, 615: 0.164, 620: 0.166, 625: 0.167,
    630: 0.169, 635: 0.170, 640: 0.172, 645: 0.173, 650: 0.175,
    655: 0.176, 660: 0.178, 665: 0.179, 670: 0.181, 675: 0.182,
    680: 0.184, 685: 0.185, 690: 0.187, 695: 0.188, 700: 0.190,
    705: 0.191, 710: 0.193, 715: 0.194, 720: 0.196, 725: 0.197,
    730: 0.199, 735: 0.200, 740: 0.202, 745: 0.203, 750: 0.205,
    755: 0.206, 760: 0.208, 765: 0.209, 770: 0.211, 775: 0.212,
    780: 0.214
  },
  // TCS09: Strong red (4.5R 4/13 in Munsell) - R9
  TCS09: {
    380: 0.069, 385: 0.070, 390: 0.072, 395: 0.073, 400: 0.075,
    405: 0.076, 410: 0.078, 415: 0.079, 420: 0.081, 425: 0.082,
    430: 0.084, 435: 0.085, 440: 0.087, 445: 0.088, 450: 0.090,
    455: 0.091, 460: 0.093, 465: 0.094, 470: 0.096, 475: 0.097,
    480: 0.099, 485: 0.100, 490: 0.102, 495: 0.103, 500: 0.105,
    505: 0.106, 510: 0.108, 515: 0.109, 520: 0.111, 525: 0.112,
    530: 0.114, 535: 0.115, 540: 0.117, 545: 0.118, 550: 0.120,
    555: 0.121, 560: 0.123, 565: 0.124, 570: 0.126, 575: 0.127,
    580: 0.129, 585: 0.130, 590: 0.132, 595: 0.133, 600: 0.135,
    605: 0.136, 610: 0.138, 615: 0.139, 620: 0.141, 625: 0.142,
    630: 0.144, 635: 0.145, 640: 0.147, 645: 0.148, 650: 0.150,
    655: 0.151, 660: 0.153, 665: 0.154, 670: 0.156, 675: 0.157,
    680: 0.159, 685: 0.160, 690: 0.162, 695: 0.163, 700: 0.165,
    705: 0.166, 710: 0.168, 715: 0.169, 720: 0.171, 725: 0.172,
    730: 0.174, 735: 0.175, 740: 0.177, 745: 0.178, 750: 0.180,
    755: 0.181, 760: 0.183, 765: 0.184, 770: 0.186, 775: 0.187,
    780: 0.189
  },
  // TCS10: Strong yellow (5Y 8/10 in Munsell) - R10
  TCS10: {
    380: 0.041, 385: 0.042, 390: 0.043, 395: 0.044, 400: 0.045,
    405: 0.046, 410: 0.047, 415: 0.048, 420: 0.049, 425: 0.050,
    430: 0.051, 435: 0.052, 440: 0.053, 445: 0.054, 450: 0.055,
    455: 0.056, 460: 0.057, 465: 0.058, 470: 0.059, 475: 0.060,
    480: 0.061, 485: 0.062, 490: 0.063, 495: 0.064, 500: 0.065,
    505: 0.066, 510: 0.067, 515: 0.068, 520: 0.069, 525: 0.070,
    530: 0.071, 535: 0.072, 540: 0.073, 545: 0.074, 550: 0.075,
    555: 0.076, 560: 0.077, 565: 0.078, 570: 0.079, 575: 0.080,
    580: 0.081, 585: 0.082, 590: 0.083, 595: 0.084, 600: 0.085,
    605: 0.086, 610: 0.087, 615: 0.088, 620: 0.089, 625: 0.090,
    630: 0.091, 635: 0.092, 640: 0.093, 645: 0.094, 650: 0.095,
    655: 0.096, 660: 0.097, 665: 0.098, 670: 0.099, 675: 0.100,
    680: 0.101, 685: 0.102, 690: 0.103, 695: 0.104, 700: 0.105,
    705: 0.106, 710: 0.107, 715: 0.108, 720: 0.109, 725: 0.110,
    730: 0.111, 735: 0.112, 740: 0.113, 745: 0.114, 750: 0.115,
    755: 0.116, 760: 0.117, 765: 0.118, 770: 0.119, 775: 0.120,
    780: 0.121
  },
  // TCS11: Strong green (4.5G 5/8 in Munsell) - R11
  TCS11: {
    380: 0.070, 385: 0.072, 390: 0.074, 395: 0.076, 400: 0.078,
    405: 0.080, 410: 0.082, 415: 0.084, 420: 0.086, 425: 0.088,
    430: 0.090, 435: 0.092, 440: 0.094, 445: 0.096, 450: 0.098,
    455: 0.100, 460: 0.102, 465: 0.104, 470: 0.106, 475: 0.108,
    480: 0.110, 485: 0.112, 490: 0.114, 495: 0.116, 500: 0.118,
    505: 0.120, 510: 0.122, 515: 0.124, 520: 0.126, 525: 0.128,
    530: 0.130, 535: 0.132, 540: 0.134, 545: 0.136, 550: 0.138,
    555: 0.140, 560: 0.142, 565: 0.144, 570: 0.146, 575: 0.148,
    580: 0.150, 585: 0.152, 590: 0.154, 595: 0.156, 600: 0.158,
    605: 0.160, 610: 0.162, 615: 0.164, 620: 0.166, 625: 0.168,
    630: 0.170, 635: 0.172, 640: 0.174, 645: 0.176, 650: 0.178,
    655: 0.180, 660: 0.182, 665: 0.184, 670: 0.186, 675: 0.188,
    680: 0.190, 685: 0.192, 690: 0.194, 695: 0.196, 700: 0.198,
    705: 0.200, 710: 0.202, 715: 0.204, 720: 0.206, 725: 0.208,
    730: 0.210, 735: 0.212, 740: 0.214, 745: 0.216, 750: 0.218,
    755: 0.220, 760: 0.222, 765: 0.224, 770: 0.226, 775: 0.228,
    780: 0.230
  },
  // TCS12: Strong blue (3PB 3/11 in Munsell) - R12
  TCS12: {
    380: 0.184, 385: 0.197, 390: 0.212, 395: 0.227, 400: 0.242,
    405: 0.258, 410: 0.275, 415: 0.292, 420: 0.310, 425: 0.328,
    430: 0.347, 435: 0.366, 440: 0.386, 445: 0.406, 450: 0.427,
    455: 0.448, 460: 0.470, 465: 0.492, 470: 0.515, 475: 0.538,
    480: 0.562, 485: 0.586, 490: 0.611, 495: 0.636, 500: 0.662,
    505: 0.688, 510: 0.715, 515: 0.742, 520: 0.770, 525: 0.798,
    530: 0.827, 535: 0.856, 540: 0.886, 545: 0.916, 550: 0.947,
    555: 0.978, 560: 1.010, 565: 1.042, 570: 1.075, 575: 1.108,
    580: 1.142, 585: 1.176, 590: 1.211, 595: 1.246, 600: 1.282,
    605: 1.318, 610: 1.355, 615: 1.392, 620: 1.430, 625: 1.468,
    630: 1.507, 635: 1.546, 640: 1.586, 645: 1.626, 650: 1.667,
    655: 1.708, 660: 1.750, 665: 1.792, 670: 1.835, 675: 1.878,
    680: 1.922, 685: 1.966, 690: 2.011, 695: 2.056, 700: 2.102,
    705: 2.148, 710: 2.195, 715: 2.242, 720: 2.290, 725: 2.338,
    730: 2.387, 735: 2.436, 740: 2.486, 745: 2.536, 750: 2.587,
    755: 2.638, 760: 2.690, 765: 2.742, 770: 2.795, 775: 2.848,
    780: 2.902
  },
  // TCS13: Light yellowish pink (5YR 8/4 in Munsell) - Caucasian skin
  TCS13: {
    380: 0.113, 385: 0.114, 390: 0.115, 395: 0.116, 400: 0.117,
    405: 0.118, 410: 0.119, 415: 0.120, 420: 0.121, 425: 0.122,
    430: 0.123, 435: 0.124, 440: 0.125, 445: 0.126, 450: 0.127,
    455: 0.128, 460: 0.129, 465: 0.130, 470: 0.131, 475: 0.132,
    480: 0.133, 485: 0.134, 490: 0.135, 495: 0.136, 500: 0.137,
    505: 0.138, 510: 0.139, 515: 0.140, 520: 0.141, 525: 0.142,
    530: 0.143, 535: 0.144, 540: 0.145, 545: 0.146, 550: 0.147,
    555: 0.148, 560: 0.149, 565: 0.150, 570: 0.151, 575: 0.152,
    580: 0.153, 585: 0.154, 590: 0.155, 595: 0.156, 600: 0.157,
    605: 0.158, 610: 0.159, 615: 0.160, 620: 0.161, 625: 0.162,
    630: 0.163, 635: 0.164, 640: 0.165, 645: 0.166, 650: 0.167,
    655: 0.168, 660: 0.169, 665: 0.170, 670: 0.171, 675: 0.172,
    680: 0.173, 685: 0.174, 690: 0.175, 695: 0.176, 700: 0.177,
    705: 0.178, 710: 0.179, 715: 0.180, 720: 0.181, 725: 0.182,
    730: 0.183, 735: 0.184, 740: 0.185, 745: 0.186, 750: 0.187,
    755: 0.188, 760: 0.189, 765: 0.190, 770: 0.191, 775: 0.192,
    780: 0.193
  },
  // TCS14: Moderate olive green (5GY 4/4 in Munsell) - Leaf green
  TCS14: {
    380: 0.050, 385: 0.052, 390: 0.054, 395: 0.056, 400: 0.058,
    405: 0.060, 410: 0.062, 415: 0.064, 420: 0.066, 425: 0.068,
    430: 0.070, 435: 0.072, 440: 0.074, 445: 0.076, 450: 0.078,
    455: 0.080, 460: 0.082, 465: 0.084, 470: 0.086, 475: 0.088,
    480: 0.090, 485: 0.092, 490: 0.094, 495: 0.096, 500: 0.098,
    505: 0.100, 510: 0.102, 515: 0.104, 520: 0.106, 525: 0.108,
    530: 0.110, 535: 0.112, 540: 0.114, 545: 0.116, 550: 0.118,
    555: 0.120, 560: 0.122, 565: 0.124, 570: 0.126, 575: 0.128,
    580: 0.130, 585: 0.132, 590: 0.134, 595: 0.136, 600: 0.138,
    605: 0.140, 610: 0.142, 615: 0.144, 620: 0.146, 625: 0.148,
    630: 0.150, 635: 0.152, 640: 0.154, 645: 0.156, 650: 0.158,
    655: 0.160, 660: 0.162, 665: 0.164, 670: 0.166, 675: 0.168,
    680: 0.170, 685: 0.172, 690: 0.174, 695: 0.176, 700: 0.178,
    705: 0.180, 710: 0.182, 715: 0.184, 720: 0.186, 725: 0.188,
    730: 0.190, 735: 0.192, 740: 0.194, 745: 0.196, 750: 0.198,
    755: 0.200, 760: 0.202, 765: 0.204, 770: 0.206, 775: 0.208,
    780: 0.210
  }
};

// Calculate XYZ tristimulus values
function calculateXYZ(spd: SpectralData): { X: number; Y: number; Z: number } {
  let X = 0, Y = 0, Z = 0;
  
  // No normalization needed for relative SPDs
  // The CIE standard uses relative values
  for (let wl = 380; wl <= 780; wl += 5) {
    const intensity = spd[wl] || spd[wl.toString()] || 0;
    X += intensity * (CIE_1931_X[wl] || 0);
    Y += intensity * (CIE_1931_Y[wl] || 0);
    Z += intensity * (CIE_1931_Z[wl] || 0);
  }

  return { X, Y, Z };
}

// Calculate CIE 1960 UCS chromaticity coordinates (u, v)
function calculateUV(X: number, Y: number, Z: number): { u: number; v: number } {
  const sum = X + Y + Z;
  if (sum === 0) return { u: 0, v: 0 };
  
  const u = 4 * X / (X + 15 * Y + 3 * Z);
  const v = 6 * Y / (X + 15 * Y + 3 * Z);
  
  return { u, v };
}

// Calculate CCT using McCamy's approximation
function calculateCCTFromUV(u: number, v: number): number {
  // Convert u,v to x,y
  const x = (3 * u) / (2 * u - 8 * v + 4);
  const y = (2 * v) / (2 * u - 8 * v + 4);
  
  // McCamy's approximation
  const n = (x - 0.3320) / (y - 0.1858);
  const cct = -449 * Math.pow(n, 3) + 3525 * Math.pow(n, 2) - 6823.3 * n + 5520.33;
  
  // Clamp to reasonable range
  if (cct < 1000) return 1000;
  if (cct > 25000) return 25000;
  
  return Math.round(cct);
}

// Get Planckian radiator SPD
function getPlanckianSPD(cct: number): SpectralData {
  const spd: SpectralData = {};
  const c1 = 3.74183e-16; // 2πhc²
  const c2 = 1.4388e-2;   // hc/k
  
  for (let wl = 380; wl <= 780; wl += 5) {
    const wavelengthM = wl * 1e-9;
    const power = c1 / (Math.pow(wavelengthM, 5) * (Math.exp(c2 / (wavelengthM * cct)) - 1));
    spd[wl] = power;
  }
  
  // Normalize to relative values (max = 1)
  const max = Math.max(...Object.values(spd));
  for (const wl in spd) {
    spd[wl] = spd[wl] / max;
  }
  
  return spd;
}

// Get CIE Daylight SPD
function getDaylightSPD(cct: number): SpectralData {
  // For simplicity, use Planckian for now
  // A full implementation would use the proper daylight formulas
  // with S0, S1, S2 basis functions
  return getPlanckianSPD(cct);
}

// Get reference illuminant based on CCT
function getReferenceIlluminant(cct: number): SpectralData {
  if (cct < 5000) {
    return getPlanckianSPD(cct);
  } else {
    return getDaylightSPD(cct);
  }
}

// Von Kries chromatic adaptation for CRI
function chromaticAdaptationCRI(
  u_test: number, 
  v_test: number,
  u_ref: number,
  v_ref: number,
  u_sample: number,
  v_sample: number
): { u: number; v: number } {
  // CIE 13.3-1995 Von Kries transformation
  // Following equation from CIE 13.3-1995
  const c_ref = (4 - u_ref - 10 * v_ref) / v_ref;
  const d_ref = (1.708 * v_ref + 0.404 - 1.481 * u_ref) / v_ref;
  
  const c_test = (4 - u_test - 10 * v_test) / v_test;
  const d_test = (1.708 * v_test + 0.404 - 1.481 * u_test) / v_test;
  
  // Transform the sample from test to reference illuminant
  const u_prime = (10.872 + 0.404 * c_ref / c_test * u_sample - 4 * d_ref / d_test * v_sample) / 
                   (16.518 + 1.481 * c_ref / c_test * u_sample - d_ref / d_test * v_sample);
  const v_prime = 5.520 / (16.518 + 1.481 * c_ref / c_test * u_sample - d_ref / d_test * v_sample);
  
  return { u: u_prime, v: v_prime };
}

// Transform to CIE 1964 W*U*V* color space
function toWUV(u: number, v: number, Y: number): { W: number; U: number; V: number } {
  const W = 25 * Math.pow(Y, 1/3) - 17;
  const U = 13 * W * (u - 0.1978);  // u_n for 2° observer
  const V = 13 * W * (v - 0.3122);  // v_n for 2° observer
  
  return { W, U, V };
}

// Calculate color difference in W*U*V* space
function calculateColorDifferenceWUV(
  W1: number, U1: number, V1: number,
  W2: number, U2: number, V2: number
): number {
  const dW = W1 - W2;
  const dU = U1 - U2;
  const dV = V1 - V2;
  
  return Math.sqrt(dW * dW + dU * dU + dV * dV);
}

// Calculate individual Ri value
function calculateRi(deltaE: number): number {
  const Ri = 100 - 4.6 * deltaE;
  return Math.max(0, Math.min(100, Ri));
}

// Main CRI calculation function
export function calculateCRICIE(spd: SpectralData): {
  Ra: number;
  R1: number;
  R2: number;
  R3: number;
  R4: number;
  R5: number;
  R6: number;
  R7: number;
  R8: number;
  R9: number;
  R10: number;
  R11: number;
  R12: number;
  R13: number;
  R14: number;
  R15: number;
} {
  try {
    // Calculate test source XYZ and chromaticity
    const testXYZ = calculateXYZ(spd);
    const testUV = calculateUV(testXYZ.X, testXYZ.Y, testXYZ.Z);
    
    // Calculate CCT
    const cct = calculateCCTFromUV(testUV.u, testUV.v);
    
    // Get reference illuminant
    const refSPD = getReferenceIlluminant(cct);
    const refXYZ = calculateXYZ(refSPD);
    const refUV = calculateUV(refXYZ.X, refXYZ.Y, refXYZ.Z);
    
    // Calculate Ri for each test color sample
    const Ri_values: number[] = [];
    
    for (let i = 1; i <= 14; i++) {
      const tcsKey = `TCS${i.toString().padStart(2, '0')}`;
      const tcsReflectance = TCS_REFLECTANCE[tcsKey];
      
      if (!tcsReflectance) continue;
      
      // Calculate sample under test illuminant
      let testSampleX = 0, testSampleY = 0, testSampleZ = 0;
      let refSampleX = 0, refSampleY = 0, refSampleZ = 0;
      
      for (let wl = 380; wl <= 780; wl += 5) {
        const reflectance = tcsReflectance[wl] || 0;
        const testIntensity = (spd[wl] || spd[wl.toString()] || 0) * reflectance;
        const refIntensity = (refSPD[wl] || 0) * reflectance;
        
        testSampleX += testIntensity * (CIE_1931_X[wl] || 0);
        testSampleY += testIntensity * (CIE_1931_Y[wl] || 0);
        testSampleZ += testIntensity * (CIE_1931_Z[wl] || 0);
        
        refSampleX += refIntensity * (CIE_1931_X[wl] || 0);
        refSampleY += refIntensity * (CIE_1931_Y[wl] || 0);
        refSampleZ += refIntensity * (CIE_1931_Z[wl] || 0);
      }
      
      // Calculate chromaticity
      const testSampleUV = calculateUV(testSampleX, testSampleY, testSampleZ);
      const refSampleUV = calculateUV(refSampleX, refSampleY, refSampleZ);
      
      // Apply chromatic adaptation
      const adaptedUV = chromaticAdaptationCRI(
        testUV.u, testUV.v,
        refUV.u, refUV.v,
        testSampleUV.u, testSampleUV.v
      );
      
      // Transform to W*U*V*
      const testWUV = toWUV(adaptedUV.u, adaptedUV.v, testSampleY);
      const refWUV = toWUV(refSampleUV.u, refSampleUV.v, refSampleY);
      
      // Calculate color difference
      const deltaE = calculateColorDifferenceWUV(
        testWUV.W, testWUV.U, testWUV.V,
        refWUV.W, refWUV.U, refWUV.V
      );
      
      // Calculate Ri
      const Ri = calculateRi(deltaE);
      Ri_values.push(Ri);
    }
    
    // Calculate Ra (average of R1-R8)
    const Ra = Ri_values.slice(0, 8).reduce((sum, val) => sum + val, 0) / 8;
    
    return {
      Ra: Math.round(Ra),
      R1: Math.round(Ri_values[0] || 0),
      R2: Math.round(Ri_values[1] || 0),
      R3: Math.round(Ri_values[2] || 0),
      R4: Math.round(Ri_values[3] || 0),
      R5: Math.round(Ri_values[4] || 0),
      R6: Math.round(Ri_values[5] || 0),
      R7: Math.round(Ri_values[6] || 0),
      R8: Math.round(Ri_values[7] || 0),
      R9: Math.round(Ri_values[8] || 0),
      R10: Math.round(Ri_values[9] || 0),
      R11: Math.round(Ri_values[10] || 0),
      R12: Math.round(Ri_values[11] || 0),
      R13: Math.round(Ri_values[12] || 0),
      R14: Math.round(Ri_values[13] || 0),
      R15: 0  // TCS15 not included in this simplified implementation
    };
  } catch (error) {
    console.error('Error calculating CRI:', error);
    return {
      Ra: 0,
      R1: 0, R2: 0, R3: 0, R4: 0, R5: 0,
      R6: 0, R7: 0, R8: 0, R9: 0, R10: 0,
      R11: 0, R12: 0, R13: 0, R14: 0, R15: 0
    };
  }
}